<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <link type="text/css" href="../dist/theme/light/site.Light.css" rel="stylesheet" />
    <link id="theme" type="text/css" href="../dist/theme/color/ui.metro.SeaBlue.css" rel="stylesheet" />
    <style type="text/css">
        html {
            overflow: auto;
        }
        body {
            height: auto;
        }
        .heighter {
            position: absolute;
            width: 1px;
            top: 0;
            left: 0;
        }
        .container-item {
            width: 100%;
            height: auto;
            position: relative;
            overflow: hidden;
        }
        .container-item-fixed {
            position: fixed;
            top: 0px;
            left: 0px;
        }
        .container-item-fixed .container-background {
        }
        .container-background {
        }
        .container-panel {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            position: absolute;
            display: flex;
            flex-flow: column nowrap;
            overflow: hidden;
        }
        .head-title {
            font-size: 2em;
        }
        .container-item-bg-image {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        /* Main Section */
        .main-panel {
            width: 50%;
            height: 100%;
            flex: 0 0 auto;
            display: flex;
            flex-flow: column nowrap;
        }
        .main-header {
        }
        #bg2 {
            -webkit-transform: scale(1.5, 1.5);
            -ms-transform: scale(1.5, 1.5);
            -o-transform: scale(1.5, 1.5);
            -moz-transform: scale(1.5, 1.5);
            transform: scale(1.5, 1.5);
        }
        #bg2.start-animation {
            -webkit-transform: scale(1, 1);
            -webkit-transition: -webkit-transform 20s linear 0s;
            -ms-transform: scale(1, 1);
            -ms-transition: -ms-transform 20s linear 0s;
            -o-transform: scale(1, 1);
            -o-transition: -o-transform 20s linear 0s;
            -moz-transform: scale(1, 1);
            -moz-transition: -moz-transform 20s linear 0s;
            transform: scale(1, 1);
            transition: transform 20s linear 0s;
        }
        /* Theme Section */
        .theme-container-item {
            width: 100%;
            overflow: hidden;
            position: relative;
        }
        .theme-box {
            width: 240px;
            height: 240px;
            border: 2px solid #aaa;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -121px;
            margin-left: -121px;
            border-radius: 10px;
        }
        .demo-background {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .demo-box {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .demo-group {
        }
        .demo-title {
        }
        .demo-item {
            display: inline-block;
            vertical-align: top;
            height: 32px;
            line-height: 32px;
            width: auto;
            border: 1px solid #000;
            border-radius: 16px;
            overflow: hidden;
        }
        .demo-item:hover {
            text-decoration: none;
        }
        .demo-item-icon {
            display: inline-block;
            vertical-align: top;
            width: 32px;
            height: 32px;
            background-color: #ccc;
            border-radius: 50%;
        }
        .demo-item-text {
            font-size: 1.1em;
            margin-right: 16px;
        }
        .h1 {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -50px;
            margin-left: -50px;
            font-size: 48pt;
        }
    </style>
    <style type="text/css">
        @media screen and (min-width:1200px) {
        }
        @media screen and (min-width: 960px) and (max-width: 1199px) {
        }
        @media screen and (min-width: 768px) and (max-width: 959px) {
        }
        @media only screen and (min-width: 480px) and (max-width: 767px) {
        }
        @media only screen and (max-width: 767px) {
        }
        @media only screen and (max-width: 479px) {
        }
    </style>
</head>
<body>
    <div class="heighter"></div>
    <section class="container-item" style="background-color:rgba(255, 255, 255, .2);z-index:10;">
        <div class="container-panel" style="height:50%;top:25%;background-color:rgba(255, 255, 255, .5);flex-direction:row;justify-content:center;">
            <div class="main-panel">
                <h1 class="head-title">
                    <span>SOON</span><span>.</span><span>UI</span>
                </h1>
                <h5>version: 3.0</h5>
                <p>
                    我是描述文本，我是描述文本
                </p>
                <a href="javascript:void(0)">GitHub</a>
                <a href="javascript:void(0)">下载</a>
            </div>
        </div>
    </section>
    <section class="container-item" style="background-color:#99aacc;z-index:9;">
        <img id="bg2" class="container-item-bg-image" src="" alt="" />
        <div class="container-panel" style="opacity:0;background-color:#000;"></div>
    </section>
    <section class="container-item" style="z-index:8;">
        <div class="theme-container-item" style="background-color:#fff;height:60%;"></div>
        <div class="theme-container-item" style="top:-18%;height:70%;">
            <div style="width:100%;height:100%;position:absolute;">
                <svg viewBox="0 0 2560 2560" preserveAspectRatio="xMidYMid slice" 
                        xmlns:dc="http://purl.org/dc/elements/1.1/" 
                        xmlns="http://www.w3.org/2000/svg" 
                        xmlns:xlink="http://www.w3.org/1999/xlink" 
                        version="1.1" class="section__svg">
                    <defs>
                        <clipPath id="clipPathDark">
                            <path fill="none" class="section__svg-path" d="M2560,0 0,200 0,2560 2560,2560z"/>
                        </clipPath>
                    </defs>
                    <rect width="100%" height="100%" fill="#1d1f21" clip-path="url(#clipPathDark)" />
                </svg>
            </div>
            <div style="position:absolute;width:100%;height:80%;top:10%;">
                <h1>2</h1>
            </div>
        </div>
        <div class="theme-box border-highlight theme-panel"></div>
    </section>
    <section class="container-item" style="background-color:#fff;z-index:7;">
        <div class="demo-background">
            <canvas id="colorLines" style="width:100%;height:100%;"></canvas>
        </div>
        <div class="demo-box">
            <h2 class="head-title">DEMO</h2>
            <dl class="demo-group">
                <dt class="demo-title"></dt>
                <dd class="">
                    <a href="javascript:void(0)" class="demo-item background-highlight">
                        <i class="demo-item-icon"></i>
                        <span class="demo-item-text">表格视图</span>
                    </a>
                </dd>
            </dl>
        </div>
    </section>
    <section class="container-item" style="background-color:#ccc;z-index:6;">
        <h1>4</h1>
    </section>
    <section class="container-item" style="background-color:#f1f1f1;z-index:5;">
        <h1>5</h1>
    </section>
    <section class="container-item" style="background-color:#ccc;z-index:4;">
        <h1>6</h1>
    </section>
    <section class="container-item" style="background-color:#f1f1f1;z-index:3;">
        <h1>7</h1>
    </section>

    <script type="text/javascript" src="../jquery.js"></script>
    <script type="text/javascript" src="../dist/SOON.UI.3.0.0.all.js"></script>
    <script type="text/javascript">
        (function() {
            var 
                layer,
                backgroundImage,
                wave;

            $(document).ready(function(e) {
                layer.init();

                function onResize() {
                    var width = document.documentElement.clientWidth,
                        height = document.documentElement.clientHeight;

                    layer.resize(width, height);
                    backgroundImage.resize(width, height);
                };
                ui.page.resize(onResize);
                onResize();
                
                $(document).on("scroll", function() {
                    layer.setFixedItems();
                });
                backgroundImage.load();
                /**
                setTimeout(function() {
                    demoSection();
                });
                */
            });

            layer = {
                heighter: null,
                sections: null,
                sectionOperators: [],
                currentIndex: -1,
                lastScrollTop: 0,
                direction: null,
                init: function() {
                    this.sections = $(".container-item");
                    this.heighter = $(".heighter");

                    this.events = new ui.CustomEvent(this);
                    this.events.initEvents(["move", "change"]);
                },
                setFixedItems: function() {
                    var scrollTop,
                        section,
                        i, len, 
                        operator,
                        lastIndex,
                        index;

                    scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                    if(scrollTop > this.lastScrollTop) {
                        this.direction = "down";
                    } else {
                        this.direction = "up";
                    }
                    this.lastScrollTop = scrollTop;
                    index = Math.floor((scrollTop + this.itemHeight) / this.itemHeight) - 1;

                    this.fire("move", index, scrollTop, this.itemHeight);
                    if(this.currentIndex === index) {
                        return;
                    }

                    // 停止当前的特效
                    /*
                    operator = this.sectionOperators[this.currentIndex];
                    if(operator) {
                        operator.stop();
                    }
                    */

                    for(i = 0, len = this.sections.length; i < len; i++) {
                        section = $(this.sections[i]);
                        if(i <= index) {
                            section.removeClass("container-item-fixed");
                        } else {
                            if(!section.hasClass("container-item-fixed")) {
                                section.addClass("container-item-fixed");
                            }
                        }
                    }
                    lastIndex = this.currentIndex;
                    this.currentIndex = index;

                    this.fire("change", lastIndex, index);

                    // 开始新的节点特效
                    /*
                    operator = this.sectionOperators[index];
                    if(operator) {
                        operator.start();
                    }
                    */
                    
                },
                resize: function(width, height) {
                    this.sections.css("height", height + "px");
                    this.heighter.css("height", height * this.sections.length + "px");

                    this.itemHeight = height;
                    this.setFixedItems();
                }
            };

            backgroundImage = {
                images: [],
                load: function() {
                    var width = document.documentElement.clientWidth,
                        height = document.documentElement.clientHeight,
                        loader,
                        that;
                    
                    that = this;
                    loader = ui.ImageLoader();
                    loader
                        .load("./content/pictures/7.jpg", width, height, ui.ImageLoader.centerCrop)
                        .then(function(loader) {
                            var img = $("#bg2");
                            img.css({
                                "width": loader.displayWidth + "px",
                                "height": loader.displayHeight + "px",
                                "top": loader.marginTop + "px",
                                "left": loader.marginLeft + "px"
                            });
                            that.images.push({
                                imgElem: img,
                                imgInfo: loader
                            });
                            img.prop("src", loader.src);
                            // chrome会不执行动画效果，需要一个MacroTask做延迟
                            setTimeout(function() {
                                img.addClass("start-animation");
                            }, 16);
                        });
                },
                resize: function(width, height) {
                    this.images.forEach(function(item) {
                        item.imgInfo.width = width;
                        item.imgInfo.height = height;
                        ui.ImageLoader.centerCrop.call(item.imgInfo);
                        item.imgElem.css({
                            "width": item.imgInfo.displayWidth + "px",
                            "height": item.imgInfo.displayHeight + "px",
                            "top": item.imgInfo.marginTop + "px",
                            "left": item.imgInfo.marginLeft + "px"
                        });
                    });
                }
            };


            var requestAnimationFrame = ui.getRequestAnimationFrame();
            var cancelAnimationFrame = ui.getCancelAnimationFrame();
            function demoSection() {
                initWave();
                wave.resize();
                wave.start();
                sectionOperators[2] = {
                    start: function() {
                        wave.start();
                    },
                    stop: function() {
                        wave.stop();
                    }
                };
            }

            function initWave() {
                var canvas = $("#colorLines"),
                    width = canvas.width(),
                    height = canvas.height(),
                    resize;
                wave = ui.effect.Wave(canvas.get(0), width, height);
                resize = wave.resize;
                wave.resize = function() {
                    var div, 
                        section,
                        width, height,
                        top, left;
                    div = canvas.parent();
                    section = div.parent();
                    width = section.width();
                    height = section.height();
                    left = width - (width * Math.sin(75 * Math.PI / 180));
                    top = height - (width * Math.sin(15 * Math.PI / 180));
                    div.css("transform", "rotate(-30deg) translate(" + left + "px, " + top + "px)");
                };
                wave.push(
                    ui.effect.WaveArea({
                        context: wave.context,
                        speed: 0.02,
                        deep: .6,
                        level: 0.08,
                        waveMax: 1.2,
                        attenuation: .6,
                        K: 1.5,
                        F: 8,
                        width: width,
                        height: height,
                        thin: 4,
                        color: "rgba(232,113,141,.3)",
                        bgColor: "rgba(255,255,255,1)"
                    })
                    , ui.effect.WaveArea({
                        context: wave.context,
                        speed: 0.01,
                        deep: 1,
                        level: 0.07,
                        waveMax: 3,
                        attenuation: 1,
                        K: 1,
                        F: 8,
                        width: width,
                        height: height,
                        thin: 4,
                        color: "rgba(1,170,167,.3)",
                        bgColor:"rgba(255,255,255,1)"
                    })
                );
            }
        })();
    </script>
</body>
</html>
